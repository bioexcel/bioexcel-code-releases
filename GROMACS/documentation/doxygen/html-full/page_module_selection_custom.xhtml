<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Gromacs: Custom selection methods</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Gromacs
   &#160;<span id="projectnumber">2016.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.xhtml"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.xhtml"><span>Modules</span></a></li>
      <li class="current"><a href="pages.xhtml"><span>Other&#160;Docs</span></a></li>
      <li><a href="namespaces.xhtml"><span>Namespaces</span></a></li>
      <li><a href="annotated.xhtml"><span>Classes</span></a></li>
      <li><a href="files.xhtml"><span>Files</span></a></li>
      <li><a href="examples.xhtml"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.xhtml">GROMACS</a></li><li class="navelem"><a class="el" href="page_analysisframework.xhtml">Framework for trajectory analysis</a></li><li class="navelem"><a class="el" href="page_selections.xhtml">Dynamic selections</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Custom selection methods </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Custom selection methods are defined by creating a new instance of <code><a class="el" href="structgmx__ana__selmethod__t.xhtml" title="Describes a selection method. ">gmx_ana_selmethod_t</a></code> and filling it with the necessary data for handling the selection. The structure contains callback pointers that define the actual behavior of the method. The following sections discuss how the structure should be filled and how to implement the callbacks.</p>
<h1><a class="anchor" id="selmethods_define"></a>
\c gmx_ana_selmethod_t data structure</h1>
<p>An example <code><a class="el" href="structgmx__ana__selmethod__t.xhtml" title="Describes a selection method. ">gmx_ana_selmethod_t</a></code> definition could look like this:</p>
<div class="fragment"><div class="line">  <a class="code" href="structgmx__ana__selmethod__t.xhtml">gmx_ana_selmethod_t</a> sm_example = {</div>
<div class="line">      <span class="stringliteral">&quot;example&quot;</span>, <a class="code" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6">GROUP_VALUE</a>, 0,</div>
<div class="line">      <a class="code" href="group__module__utility.xhtml#ga0883345a58f8f63aefa249a4f127f707">asize</a>(sm_params_example), sm_params_example,</div>
<div class="line">      &amp;init_data_example,</div>
<div class="line">       NULL,</div>
<div class="line">      &amp;init_example,</div>
<div class="line">       NULL,</div>
<div class="line">      &amp;free_data_example,</div>
<div class="line">      &amp;init_frame_example,</div>
<div class="line">      &amp;evaluate_example,</div>
<div class="line">       NULL,</div>
<div class="line">      {<span class="stringliteral">&quot;example from POS_EXPR [cutoff REAL]&quot;</span>, NULL, 0, NULL},</div>
<div class="line">  };</div>
<div class="line">* </div>
</div><!-- fragment --><p>The first value defines the name of the method. It is used mostly for informational purposes; the actual name(s) recognized by the selection parser are defined by the call to <a class="el" href="selmethod_8cpp.xhtml#a8dc364fb06ad40e8176409907d6d8087" title="Registers a selection method. ">gmx_ana_selmethod_register()</a> (see <a class="el" href="page_module_selection_custom.xhtml#selmethods_register">Registering the method</a>).</p>
<p>The second value defines the type of the value the method returns. Possible values are</p>
<ul>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8">NO_VALUE</a> : This is allowed only for methods that have the flag <a class="el" href="selmethod_8h.xhtml#aa5b18df47b72690889afd89f5e68694c">SMETH_MODIFIER</a> set (see <a class="el" href="page_module_selection_custom.xhtml#selmethods_modifiers">Selection modifiers</a>).</li>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8becacd1ce0b084595a6072a57781dc7738a0">INT_VALUE</a> : The method returns one or more integer values.</li>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca7aa9587044cd6fd9c1f1690719a072cf">REAL_VALUE</a> : The method returns one or more floating-point values.</li>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08">STR_VALUE</a> : The method returns one or more strings.</li>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a> : The method returns one or more 3D vectors.</li>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6">GROUP_VALUE</a> : The method returns a single index group.</li>
</ul>
<p>The third value gives additional information about the method using a combination of flags. Possible flags are:</p>
<ul>
<li><a class="el" href="selmethod_8h.xhtml#ac5e632efef31120c54b55eac79cb23cc">SMETH_REQTOP</a> : If set, the topology information is always loaded and the <code>top</code> pointer passed to the callbacks is guaranteed to be non-NULL. Should be set if the method requires topology information for evaluation.</li>
<li><a class="el" href="selmethod_8h.xhtml#af38b0eb2b4e305ae83ded06f9b12252e">SMETH_DYNAMIC</a> : If set, the method can only be evaluated dynamically, i.e., it requires data from the trajectory frame.</li>
<li><a class="el" href="selmethod_8h.xhtml#aa5b18df47b72690889afd89f5e68694c">SMETH_MODIFIER</a> : If set, the method is a selection modifier and not an actual selection method. For more details, see <a class="el" href="page_module_selection_custom.xhtml#selmethods_modifiers">Selection modifiers</a>.</li>
<li><a class="el" href="selmethod_8h.xhtml#a515e9a0a40f55687d9c37167e4d530a5">SMETH_ALLOW_UNSORTED</a> : If set, the method supports unsorted atoms in its input parameters. <a class="el" href="selmethod_8h.xhtml#aa5b18df47b72690889afd89f5e68694c">SMETH_MODIFIER</a> methods are assumed to always support unsorted atoms, as their purpose is to affect the ordering.</li>
</ul>
<p>There are two additional flags that specify the number of values the method returns. Only one of them can be set at a time. If neither is set, the default behavior is to evaluate a value for each input atom (except for <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6">GROUP_VALUE</a> methods, which always return a single group). Other behaviors can be specified with these flags:</p>
<ul>
<li><a class="el" href="selmethod_8h.xhtml#a2de9fc1fca93570388059f72b064df08">SMETH_SINGLEVAL</a> : If set, the method evaluates to a single value. This is automatically set if the type is <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6">GROUP_VALUE</a>.</li>
<li><a class="el" href="selmethod_8h.xhtml#ae0aa6a1bbb99ba5f0f6228c4cd401e0a">SMETH_VARNUMVAL</a> : If set, the method evaluates to an arbitrary number of values. The number of values is determined based on the values given by the user to the method parameters (see <a class="el" href="page_module_selection_custom.xhtml#selmethods_params">Defining parameters</a>).</li>
</ul>
<p>If either of these flags is specified (and the method type is not <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6">GROUP_VALUE</a>), the group passed to the evaluation callback should not be used as it can be NULL. Currently, the above flags only work (have been tested) for <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a> methods.</p>
<p>There is one additional flag that can only be specified for <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08">STR_VALUE</a> methods: <a class="el" href="selmethod_8h.xhtml#a78abdcb637f45eafa513d07aaf14a45e">SMETH_CHARVAL</a> . It is meant for to ease implementation of methods that evaluate to strings consisting of single characters.</p>
<p>The next two values determine the number of parameters and a pointer to the parameter array. The contents of the parameter array are described in <a class="el" href="page_module_selection_custom.xhtml#selmethods_params">Defining parameters</a>. If the method does not take parameters, the first value should be 0 and the second can be NULL. Currently, <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08">STR_VALUE</a> methods cannot take parameters, but this limitation should be easy to lift if required.</p>
<p>These are followed by function callbacks that determine the actual behavior of the method. Any of these except the evaluation callback can be NULL (the evaluation callback can also be NULL if <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8">NO_VALUE</a> is specified for a selection modifier). However, the presence of parameters can require some of the callbacks to be implemented. The details are described in <a class="el" href="page_module_selection_custom.xhtml#selmethods_callbacks">Implementing callbacks</a>.</p>
<p>Finally, there is a data structure that gives help texts for the method.</p>
<p>The <code><a class="el" href="structgmx__ana__selmethod__t.xhtml" title="Describes a selection method. ">gmx_ana_selmethod_t</a></code> variable should be declared as a global variable or it should be otherwise ensured that the structure is not freed: only a pointer to the structure is stored by the library.</p>
<h1><a class="anchor" id="selmethods_params"></a>
Defining parameters</h1>
<p>Parameters to selection methods are defined in a separate array of <code><a class="el" href="structgmx__ana__selparam__t.xhtml" title="Describes a single parameter for a selection method. ">gmx_ana_selparam_t</a></code> structures. The order of the parameters does not matter (except possibly for callback implementation), with one important exception: If the method evaluates to a <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a>, the first parameter should have <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca70a2af6eafa48adfab506ceee60471f6">GROUP_VALUE</a> and be the one that is used to calculate the positions.</p>
<p>An example parameter definition: </p>
<div class="fragment"><div class="line">  <span class="keyword">static</span> <a class="code" href="structgmx__ana__selparam__t.xhtml">gmx_ana_selparam_t</a> sm_params_example[] = {</div>
<div class="line">    {<span class="stringliteral">&quot;cutoff&quot;</span>, {<a class="code" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca7aa9587044cd6fd9c1f1690719a072cf">REAL_VALUE</a>, 1, {NULL}}, NULL, <a class="code" href="selparam_8h.xhtml#a9829627bea1b9a81fe204f333a6519b6">SPAR_OPTIONAL</a>},</div>
<div class="line">    {<span class="stringliteral">&quot;from&quot;</span>,   {<a class="code" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a>, -1, {NULL}}, NULL, <a class="code" href="selparam_8h.xhtml#ae44a94b4d013d2a344cfb3a9f8c5479f">SPAR_DYNAMIC</a> | <a class="code" href="selparam_8h.xhtml#a400330277d7e17cdfef1610cc37838ea">SPAR_VARNUM</a>},</div>
<div class="line">  };</div>
<div class="line">* </div>
</div><!-- fragment --><p>The first value gives the name of the parameter. The first parameter can have a NULL name, which means that the value should immediately follow the method name. This can be used to specify methods of the type 'within 5 of ...'.</p>
<p>The second value specifies the type of the value that the parameter accepts. <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8">NO_VALUE</a> can be used to specify a boolean parameter, other possibilities are the same as for the selection method type.</p>
<p>The third value gives the number of values that the parameter accepts. For boolean parameters (<a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8">NO_VALUE</a>), it should be 0. For parameters with <a class="el" href="selparam_8h.xhtml#a400330277d7e17cdfef1610cc37838ea">SPAR_VARNUM</a> of <a class="el" href="selparam_8h.xhtml#ababaf52ada40922bb660a4949e1e52f0">SPAR_ATOMVAL</a>, it should be set to -1 for consistency (it is not used). If <a class="el" href="selparam_8h.xhtml#ab39fef32ca729815df1299fafdd623b1">SPAR_RANGES</a> is specified, it should be either 1 (to accept a single continuous range) or -1 (if combined with <a class="el" href="selparam_8h.xhtml#a400330277d7e17cdfef1610cc37838ea">SPAR_VARNUM</a>). In all other cases, it should be a positive integer; in most cases, it should be 1.</p>
<p>The nest two pointers should always be NULL (they should be initialized in the callbacks), except the first pointer in the case of <a class="el" href="selparam_8h.xhtml#a9cab7952c47c82291754bb1b90db31e7">SPAR_ENUMVAL</a> (see below).</p>
<p>The final value gives additional information about the acceptable values for the parameter using a combination of flags. The possible flags are:</p>
<ul>
<li><a class="el" href="selparam_8h.xhtml#a9829627bea1b9a81fe204f333a6519b6">SPAR_OPTIONAL</a> : If set, the user does not need to provide a value for the parameter. If not set, an error is reported if the parameter is not specified by the user.</li>
<li><a class="el" href="selparam_8h.xhtml#ae44a94b4d013d2a344cfb3a9f8c5479f">SPAR_DYNAMIC</a> : If set, the method can handle dynamic values for the parameter, i.e., the value(s) can be given by an expression that evaluates to different values for different frames.</li>
<li><a class="el" href="selparam_8h.xhtml#ab39fef32ca729815df1299fafdd623b1">SPAR_RANGES</a> : Can be set only for <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8becacd1ce0b084595a6072a57781dc7738a0">INT_VALUE</a> and <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca7aa9587044cd6fd9c1f1690719a072cf">REAL_VALUE</a> parameters, and cannot be combined with <a class="el" href="selparam_8h.xhtml#ae44a94b4d013d2a344cfb3a9f8c5479f">SPAR_DYNAMIC</a>. If set, the parameter accepts ranges of values. The ranges are automatically sorted and compacted such that a minimum amount of non-overlapping ranges are given for the method.</li>
<li><a class="el" href="selparam_8h.xhtml#a400330277d7e17cdfef1610cc37838ea">SPAR_VARNUM</a> : If set, the parameter can have a variable number of values. These can be provided by the user as a list of values, or using a single <a class="el" href="selmethod_8h.xhtml#ae0aa6a1bbb99ba5f0f6228c4cd401e0a">SMETH_VARNUMVAL</a> (or a single <a class="el" href="selmethod_8h.xhtml#a2de9fc1fca93570388059f72b064df08">SMETH_SINGLEVAL</a>) method.</li>
<li><a class="el" href="selparam_8h.xhtml#ababaf52ada40922bb660a4949e1e52f0">SPAR_ATOMVAL</a> : If set, the parameter accepts either a single value or an expression that evaluates to a value for each input atom. The single input value is treated as if the same value was returned for each atom. Cannot be combined with <a class="el" href="selparam_8h.xhtml#ab39fef32ca729815df1299fafdd623b1">SPAR_RANGES</a> or <a class="el" href="selparam_8h.xhtml#a400330277d7e17cdfef1610cc37838ea">SPAR_VARNUM</a>.</li>
<li><a class="el" href="selparam_8h.xhtml#a9cab7952c47c82291754bb1b90db31e7">SPAR_ENUMVAL</a> : Can only be set for <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca6f2f1fe9592d96990c9ac690c355bd08">STR_VALUE</a> parameters that take a single value, and cannot be combined with any other flag than <a class="el" href="selparam_8h.xhtml#a9829627bea1b9a81fe204f333a6519b6">SPAR_OPTIONAL</a>. If set, the parameter only accepts one of predefined string values. See <a class="el" href="selparam_8h.xhtml#a9cab7952c47c82291754bb1b90db31e7">SPAR_ENUMVAL</a> documentation for details on how to specify the acceptable values.</li>
</ul>
<h1><a class="anchor" id="selmethods_callbacks"></a>
Implementing callbacks</h1>
<p>There are eight differen callback functions that can be implemented for selection methods: <a class="el" href="selmethod_8h.xhtml#a5acbf2d7bead71c4d96f9e69b267df56" title="Allocates and initializes internal data and parameter values. ">sel_datafunc()</a>, <a class="el" href="selmethod_8h.xhtml#ab5aa791ed8d9db644c9250028a18dc8b" title="Sets the position calculation collection for the method. ">sel_posfunc()</a>, <a class="el" href="selmethod_8h.xhtml#a7149ff249973e9c0fd49a34276305a76" title="Does initialization based on topology and/or parameter values. ">sel_initfunc()</a>, <a class="el" href="selmethod_8h.xhtml#a629ed53ce2f771dc66297458ce50abb5" title="Initializes output data structure. ">sel_outinitfunc()</a>, <a class="el" href="selmethod_8h.xhtml#a2e05a0b2274edfeab965c363f646735a" title="Frees the internal data. ">sel_freefunc()</a>, <a class="el" href="selmethod_8h.xhtml#ad7e63789da3cadbb99800dbe18d837f7" title="Initializes the evaluation for a new frame. ">sel_framefunc()</a>, and two update functions. They are in this order in the <code><a class="el" href="structgmx__ana__selmethod__t.xhtml" title="Describes a selection method. ">gmx_ana_selmethod_t</a></code> data structure. In general, any of the callbacks can be NULL, but the presence of parameters or other callbacks imposes some restrictions:</p>
<ul>
<li><a class="el" href="selmethod_8h.xhtml#a5acbf2d7bead71c4d96f9e69b267df56" title="Allocates and initializes internal data and parameter values. ">sel_datafunc()</a> should be provided if the method takes parameters.</li>
<li><a class="el" href="selmethod_8h.xhtml#a7149ff249973e9c0fd49a34276305a76" title="Does initialization based on topology and/or parameter values. ">sel_initfunc()</a> should be provided if the method takes any parameters with the <a class="el" href="selparam_8h.xhtml#a400330277d7e17cdfef1610cc37838ea">SPAR_VARNUM</a> or <a class="el" href="selparam_8h.xhtml#ababaf52ada40922bb660a4949e1e52f0">SPAR_ATOMVAL</a> flags, except if those parameters have a <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a>.</li>
<li><a class="el" href="selmethod_8h.xhtml#a629ed53ce2f771dc66297458ce50abb5" title="Initializes output data structure. ">sel_outinitfunc()</a> should be provided for <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a> methods and <a class="el" href="selmethod_8h.xhtml#ae0aa6a1bbb99ba5f0f6228c4cd401e0a">SMETH_VARNUMVAL</a> methods.</li>
<li><a class="el" href="selmethod_8h.xhtml#a2e05a0b2274edfeab965c363f646735a" title="Frees the internal data. ">sel_freefunc()</a> should be provided if <a class="el" href="selmethod_8h.xhtml#a5acbf2d7bead71c4d96f9e69b267df56" title="Allocates and initializes internal data and parameter values. ">sel_datafunc()</a> and/or <a class="el" href="selmethod_8h.xhtml#a7149ff249973e9c0fd49a34276305a76" title="Does initialization based on topology and/or parameter values. ">sel_initfunc()</a> allocate any dynamic memory in addition to the data structure itself (or allocates the data structure using some other means than malloc()).</li>
<li><a class="el" href="selmethod_8h.xhtml#a0b18405511e5ed5fabfe37fc98888121" title="Evaluates a selection method using positions. ">sel_updatefunc_pos()</a> only makes sense for methods with <a class="el" href="selmethod_8h.xhtml#af38b0eb2b4e305ae83ded06f9b12252e">SMETH_DYNAMIC</a> set.</li>
<li>At least one update function should be provided unless the method type is <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8">NO_VALUE</a>.</li>
</ul>
<p>The documentations for the function pointer types provide more information about how the callbacks should be implemented.</p>
<h1><a class="anchor" id="selmethods_modifiers"></a>
Selection modifiers</h1>
<p>Selection modifiers are a special kind of selection methods that can be appended to the end of a selection. They are specified by adding the <a class="el" href="selmethod_8h.xhtml#aa5b18df47b72690889afd89f5e68694c">SMETH_MODIFIER</a> flag to the <code><a class="el" href="structgmx__ana__selmethod__t.xhtml" title="Describes a selection method. ">gmx_ana_selmethod_t</a></code>. They can have two different types:</p>
<ul>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a> : These modifiers are given the final positions as an input, and they can make modifications to the selection that are not possible otherwise (e.g., permute the atoms). The modifier should implement <a class="el" href="selmethod_8h.xhtml#a0b18405511e5ed5fabfe37fc98888121" title="Evaluates a selection method using positions. ">sel_updatefunc_pos()</a> and also have one NULL parameter in the beginning of the parameter list that takes <a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca31a47fbfbc85ad1472ce3d2a168fd1ec">POS_VALUE</a> and is used to give the input positions.</li>
<li><a class="el" href="selvalue_8h.xhtml#a70b42b87d434580bf1493591857b8beca4d694119ce83b62d74ff06b5e017dca8">NO_VALUE</a> : These modifiers do not modify the final selection, but can be used to implement per-selection options for analysis tools or to control the default behavior of the selection engine (currently, such a framework is not implemented, but should be easy to implement if required).</li>
</ul>
<p>In addition to restricting the type of the method, selection modifiers do not allow the flags <a class="el" href="selmethod_8h.xhtml#a2de9fc1fca93570388059f72b064df08">SMETH_SINGLEVAL</a> and <a class="el" href="selmethod_8h.xhtml#ae0aa6a1bbb99ba5f0f6228c4cd401e0a">SMETH_VARNUMVAL</a> (they would not make sense).</p>
<p>Parameters and callbacks should be implemented as with normal selection method, but beware that very little of the functionality has been tested.</p>
<dl class="todo"><dt><b><a class="el" href="todo.xhtml#_todo000058">Todo:</a></b></dt><dd>The modifier handling could be made more flexible and more generic; the current implementation does not allow many things which would be possible with slight changes in the internals of the library.</dd></dl>
<h1><a class="anchor" id="selmethods_register"></a>
Registering the method</h1>
<p>After defining the method with <code><a class="el" href="structgmx__ana__selmethod__t.xhtml" title="Describes a selection method. ">gmx_ana_selmethod_t</a></code>, it should be registered with the selection engine. In analysis programs, this can be done by calling <a class="el" href="selmethod_8cpp.xhtml#a8dc364fb06ad40e8176409907d6d8087" title="Registers a selection method. ">gmx_ana_selmethod_register()</a>. If adding the method to the library, you should add a pointer to the new method structure into the <code>smtable_def</code> array (in <a class="el" href="selmethod_8cpp.xhtml" title="Implements functions in selmethod.h. ">selmethod.cpp</a>), and it is registered automatically. In both cases, <a class="el" href="selmethod_8cpp.xhtml#a8dc364fb06ad40e8176409907d6d8087" title="Registers a selection method. ">gmx_ana_selmethod_register()</a> does several checks on the structure and reports any errors or inconsistencies it finds. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Mar 13 2017 19:20:40 for Gromacs by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
