<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Gromacs: Selection method: insolidangle</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Gromacs
   &#160;<span id="projectnumber">2018.3</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.xhtml"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.xhtml"><span>Modules</span></a></li>
      <li class="current"><a href="pages.xhtml"><span>Other&#160;Docs</span></a></li>
      <li><a href="namespaces.xhtml"><span>Namespaces</span></a></li>
      <li><a href="annotated.xhtml"><span>Classes</span></a></li>
      <li><a href="files.xhtml"><span>Files</span></a></li>
      <li><a href="examples.xhtml"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.xhtml">GROMACS</a></li><li class="navelem"><a class="el" href="page_analysisframework.xhtml">Framework for trajectory analysis</a></li><li class="navelem"><a class="el" href="page_selections.xhtml">Dynamic selections</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Selection method: insolidangle </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This method selects a subset of particles that are located in a solid angle defined by a center and a set of points. The solid angle is constructed as a union of small cones whose axis goes through the center and a point. So there's such a cone for each position, and a point is in the solid angle if it lies within any of these cones. The width of the cones can be adjusted.</p>
<p>The method is implemented by partitioning the surface of the unit sphere into bins using the polar coordinates <img class="formulaInl" alt="$(\theta, \phi)$" src="form_12.png"/>. The partitioning is always uniform in the zenith angle <img class="formulaInl" alt="$\theta$" src="form_13.png"/>, while the partitioning in the azimuthal angle <img class="formulaInl" alt="$\phi$" src="form_7.png"/> varies. For each reference point, the unit vector from the center to the point is constructed, and it is stored in all the bins that overlap with the cone defined by the point. Bins that are completely covered by a single cone are marked as such. Checking whether a point is in the solid angle is then straightforward with this data structure: one finds the bin that corresponds to the point, and checks whether the bin is completely covered. If it is not, one additionally needs to check whether it is within the specified cutoff of any of the stored points.</p>
<p>The above construction gives quite a lot of flexibility for constructing the bins without modifying the rest of the code. The current (quite inefficient) implementation is discussed below, but it should be optimized to get the most out of the code.</p>
<p>The current way of constructing the bins constructs the boundaries statically: the bin size in the zenith direction is set to approximately half the angle cutoff, and the bins in the azimuthal direction have sizes such that the shortest edge of the bin is approximately equal to half the angle cutoff (for the regions close to the poles, a single bin is used). Each reference point is then added to the bins as follows:</p>
<ol type="1">
<li>Find the zenith angle range that is spanned by the cone centered at the point (this is simple addition/subtraction).</li>
<li>Calculate the maximal span of the cone in the azimuthal direction using the formula <p class="formulaDsp">
<img class="formulaDsp" alt="\[\sin \Delta \phi_{max} = \frac{\sin \alpha}{\sin \theta}\]" src="form_14.png"/>
</p>
 (a sine formula in spherical coordinates), where <img class="formulaInl" alt="$\alpha$" src="form_15.png"/> is the width of the cone and <img class="formulaInl" alt="$\theta$" src="form_13.png"/> is the zenith angle of the cone center. Similarly, the zenith angle at which this extent is achieved is calculated using <p class="formulaDsp">
<img class="formulaDsp" alt="\[\cos \theta_{max} = \frac{\cos \theta}{\cos \alpha}\]" src="form_16.png"/>
</p>
 (Pythagoras's theorem in spherical coordinates).</li>
<li>For each zenith angle bin that is at least partially covered by the cone, calculate the span of the cone at the edges using <p class="formulaDsp">
<img class="formulaDsp" alt="\[\sin^2 \frac{\Delta \phi}{2} = \frac{\sin^2 \frac{\alpha}{2} - \sin^2 \frac{\theta - \theta'}{2}}{\sin \theta \sin \theta'}\]" src="form_17.png"/>
</p>
 (distance in spherical geometry), where <img class="formulaInl" alt="$\theta'$" src="form_18.png"/> is the zenith angle of the bin edge. Treat zenith angle bins that are completely covered by the cone (in the case that the cone is centered close to the pole) as a special case.</li>
<li>Using the values calculated above, loop through the azimuthal bins that are partially or completely covered by the cone and update them.</li>
</ol>
<p>The total solid angle (for covered fraction calculations) is estimated by taking the total area of completely covered bins plus half the area of partially covered bins. The second one is an approximation, but should give reasonable estimates for the averages as well as in cases where the bin size is small. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 23 2018 14:57:23 for Gromacs by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
